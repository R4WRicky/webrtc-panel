<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel WebRTC Público</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    textarea {
      width: 90%;
      height: 120px;
      margin: 10px 0;
      font-family: monospace;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #5c6bc0;
      color: white;
      border: none;
      cursor: pointer;
    }
    video {
      width: 320px;
      height: 240px;
      background-color: black;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Panel WebRTC Público</h1>

  <textarea id="sdp-offer" placeholder="Pega aquí la oferta SDP codificada en Base64..."></textarea>
  <br>
  <button onclick="generateAnswer()">Generar Respuesta</button>
  <br>
  <textarea id="sdp-answer" placeholder="Respuesta SDP del servidor..." readonly></textarea>

  <video id="remoteVideo" autoplay playsinline controls muted></video>

  <script>
    let pc = null;

    async function generateAnswer() {
      const offerBase64 = document.getElementById("sdp-offer").value.trim();

      if (!offerBase64) {
        alert("Pega una oferta SDP válida.");
        return;
      }

      try {
        const sdp = atob(offerBase64);
        const offer = {
          type: "offer",
          sdp: sdp
        };

        pc = new RTCPeerConnection();
        const remoteVideo = document.getElementById("remoteVideo");

        pc.ontrack = function (event) {
          remoteVideo.srcObject = event.streams[0];
        };

        await pc.setRemoteDescription(offer);

        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);

        const sdpAnswerBase64 = btoa(pc.localDescription.sdp);
        document.getElementById("sdp-answer").value = sdpAnswerBase64;
      } catch (e) {
        console.error("Error al procesar la oferta:", e);
        alert("Error al generar respuesta: " + e.message);
      }
    }
  </script>
</body>
</html>
