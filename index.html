<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Panel WebRTC Público</title>
</head>
<body style="background-color: #121212; color: white; font-family: sans-serif; text-align: center; padding: 30px;">
    <h1>Panel WebRTC Público</h1>
    <textarea id="sdpOfferInput" placeholder="Oferta SDP Base64" style="width: 90%; height: 120px;"></textarea>
    <br><br>
    <button onclick="responderSDP()" style="padding: 10px 20px;">Generar Respuesta</button>
    <br><br>
    <textarea id="sdpAnswerOutput" placeholder="Respuesta SDP del servidor..." style="width: 90%; height: 150px;"></textarea>

    <script>
        async function responderSDP() {
            const offerBase64 = document.getElementById("sdpOfferInput").value.trim();
            if (!offerBase64) {
                alert("Pega la oferta del bot primero.");
                return;
            }

            try {
                const offerSDP = atob(offerBase64); // decodificar base64
                const pc = new RTCPeerConnection();

                pc.ontrack = (event) => {
                    const stream = event.streams[0];
                    const video = document.createElement("video");
                    video.srcObject = stream;
                    video.autoplay = true;
                    video.controls = true;
                    video.style.maxWidth = "80%";
                    document.body.appendChild(video);
                };

                await pc.setRemoteDescription(new RTCSessionDescription({
                    type: "offer",
                    sdp: offerSDP
                }));

                const answer = await pc.createAnswer();
                await pc.setLocalDescription(answer);

                const answerBase64 = btoa(pc.localDescription.sdp);
                document.getElementById("sdpAnswerOutput").value = answerBase64;
            } catch (err) {
                alert("Error al generar la respuesta: " + err.message);
            }
        }
    </script>
</body>
</html>
